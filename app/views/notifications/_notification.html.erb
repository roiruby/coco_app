<% visitor = notification.visitor %>
<% visited = notification.visited %>

<div class="row ml-1">
  <% case notification.action %>
    <% when 'approval' then %>
  <% else %>
  
  <div class="nav-image mr-2">
    <%= link_to image_tag(visitor.image.thmb300.to_s), user_path(visitor.id), data: {"turbolinks" => false} %>
  </div>
  
  <div class="mt-1">
    <div class="bold small">
      <%= link_to visitor.name, user_path(visitor.id), data: {"turbolinks" => false} %>
    </div>
    <div class="xxsmall gray">
      <%= visitor.catchphrase %>
    </div>
  </div>
  <% end %>
  
  <div class="small ml-3 d-flex align-items-end">
    <% case notification.action %>
      <% when 'follow' then %>
        にフォローされました！
        
      <% when 'like' then %>
        が【<%= link_to notification.post.title.truncate(26), post_path(notification.post), data: {"turbolinks" => false} %>】をお気に入りしました！
        
      <% when 'comment' then %>
        <% if notification.post.user_id == visited.id %>
          が【<%= link_to notification.post.title.truncate(26), comment_path(notification.post), data: {"turbolinks" => false} %>】
        <% else %>
          が【<%= link_to notification.post.title.truncate(26), comment_path(notification.post), data: {"turbolinks" => false} %>】
          <!--<%= notification.post.user.name + 'さんの投稿' %>-->
        <% end %>
        にコメントしました！
        
      <% when 'entry' then %>
        が【<%= link_to notification.post.title.truncate(26), post_path(notification.post), data: {"turbolinks" => false} %>】にエントリーしました！
      
      <% when 'approval' then %>
        【<%= link_to notification.post.title.truncate(26), post_path(notification.post), data: {"turbolinks" => false} %>】のメンバーに確定しました！
        
      <% when 'post' then %>
        がイベント【<%= link_to notification.post.title.truncate(26), post_path(notification.post), data: {"turbolinks" => false} %>】を作成しました！
        
      <% when 'cancel' then %>
        がイベント【<%= link_to notification.post.title.truncate(26), post_path(notification.post), data: {"turbolinks" => false} %>】をキャンセルしました。
    <% end %>
  </div>
  
</div>
  
  <% case notification.action %>
  <% when 'like', 'comment' then %>
    <div class="row row-0 mt-2">
      <div class="top-postimage col-sm-4">
        <div class="poston">
          <% if notification.post.image? %>
            <%= link_to image_tag(notification.post.image.thmb300.to_s), post_path(notification.post) %>
            <p><span class="tag1 bold xsmall">
              <%= link_to notification.post.category.name, category_path(notification.post.category.id) %>
              </span>
  
              <% notification.post.destinations.each do |destination| %>
                <% if destination.area.present? %>
                <span class="tag1 bold xsmall pl-1">
                    <%= destination.area %>
                </span>
                <% end %>
              <% end %>
            </p>
          <% else %>
            <%= link_to image_tag("default_post.jpg"), post_path(notification.post), data: {"turbolinks" => false} %>
            <p><span class="tag1 bold xsmall">
              <%= link_to notification.post.category.name, category_path(notification.post.category.id) %>
              </span>
  
              <% notification.post.destinations.each do |destination| %>
                <% if destination.area.present? %>
                <span class="tag1 bold xsmall pl-1">
                    <%= destination.area %>
                </span>
                <% end %>
              <% end %>
            </p>
          <% end %>
        </div>
      </div>
    
    
      <div class="col-sm-8 pl-2 bold">
        
        <%= link_to notification.post.title.truncate(46), post_path(notification.post), data: {"turbolinks" => false} %>
            
            <div class="small pr-1 pl-1 mt-1">
              <% date = notification.post.event_schedule.to_s(:date) %>
              <% weekday = %w[日 月 火 水 木 金 土] %>
                <div class="bold">
                  <i class="far fa-calendar-alt"></i> <%= notification.post.event_schedule.to_s(:date) %>（<%= weekday[Date.parse(date).wday] %>）<%= notification.post.event_schedule.to_s(:time) %>
                </div>
            </div>
            
            <% notification.post.destinations.each do |destination| %>
              <div class="bold small pr-1 pl-1 mt-1">
                <i class="fas fa-map-marker-alt"></i> <%= destination.name %>
              </div>
            <% end %>
            
            <div class="row ml-1 mr-1 mt-1">
              <div class="btn1 xsmall mt-1 bold mr-1">
                <%= notification.post.sex_i18n %>
              </div>
              
              <% if notification.post.member != "default" %>
                <div class="btn1 xsmall mt-1 bold mr-1">
                  <%= notification.post.member_i18n %>募集
                </div>
              <% end %>
              
              <% if notification.post.payment != "default" %>
                <div class="btn1 xsmall mt-1 bold mr-1">
                  <%= notification.post.payment_i18n %>
                </div>
              <% end %>
              
              <% if notification.post.budget != "default" %>
                <div class="btn1 xsmall mt-1 bold mr-1">
                  <%= notification.post.budget_i18n %>
                </div>
              <% end %>
            </div>
            
            <% if notification.post.cancel.present? %>
              <div class="mt-2 gray xsmall xsmall-tb">
                キャンセルされました
              </div>
            <% else %>
            <div class="mt-2 gray xsmall xsmall-tb">
              <% dt1 = Time.zone.now %>
              <% dt2 = Time.zone.parse(notification.post.dead_line.to_s) %>
              <% diff = dt2 - dt1 %>
              <% s = diff % 60 %>
              <% m = ((diff - s) / 60) % 60 %>
              <% h = ((diff - s - m * 60) / (60 ** 2)) % 24 %>
              <% d = ((diff - s - m * 60 - h * 60 ** 2) / (60**2 * 24)) %>
              
              <% if d.to_i == 0 and h.to_i > 0 %>
                <i class="far fa-clock"></i>
                残り<%= h.to_i %>時間<span class="ml-2"><i class="far fa-heart mr-1"></i><%= notification.post.favorites.count %></span>
              <% elsif d.to_i == 0 and h.to_i == 0 %>
                <i class="far fa-clock"></i>
                もうすぐ終了！<span class="ml-2"><i class="far fa-heart mr-1"></i><%= notification.post.favorites.count %></span>
              <% elsif d.to_i < 0 %>
                <i class="far fa-clock"></i>
                募集は終了しています<span class="ml-2"><i class="far fa-heart mr-1"></i><%= notification.post.favorites.count %></span>
              <% else %>
                <i class="far fa-clock"></i>
                残り<%= d.to_i %>日<span class="ml-2"><i class="far fa-heart mr-1"></i><%= notification.post.favorites.count %></span>
              <% end %>
            </div>
            <% end %>
          
      </div>
      
    </div>
    
  <% end %>
  
  <div class="gray xxsmall text-right">
    <i class="far fa-clock"></i><%= notification.created_at.strftime('%Y/%m/%d %H:%M') %>
  </div>
  
  <hr>
  